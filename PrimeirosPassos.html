<!DOCTYPE html>
<html lang="pt">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>quatroivinti</title>
    </head>
    <body>
        <canvas></canvas>
        <script>
            var canvas = document.querySelector("canvas");
            canvas.width = 830;
            canvas.height = 500;
            var dt = 0;
            var anterior = 0;
            var invy = 400;
            var tg = 0;
            var iny = 325;
            
            var pc = {};
            pc.w = 30;
            pc.vx = 0;
            pc.vy = 0;
            pc.x = 200;
            pc.y = 200;

            var pc2 = {
                x : 50,
                y : 150,
                w : 30,
                vx : 0,
                vy : 0,
                desenhar : personagem,
                perseguir : function(alvo){
                    this.vx = 200*Math.sign(alvo.x - this.x);
                    this.vy = 200*Math.sign(alvo.y - this.y);
                },
            };
            
            pc.mover = function(dt){
                pc.x = pc.x + pc.vx*dt;
                if(pc.y<=450) {
                    tg = dt/10 + tg;
                    pc.y = pc.y + pc.vy*dt + (300)*tg;
                }
                if(pc.y>450) {
                    pc.y = 450;
                    tg=0;
                    pc.vy=0;
                }
                if (pc.x >= 800 && pc.x <= 0){
                    pc.vx = 0;
                    pc.vy = 0;
                }
            }
            pc2.mover = function(dt){
                pc2.x = pc2.x + pc2.vx*dt;
                pc2.y = pc2.y + pc2.vy*dt;
                if(pc2.y>450) {
                    pc2.y = 450;
                    //tg=0;
                    pc2.vy=0;
                }
                /*{
                    if(pc2.y<=450) {
                        //tg = dt/10 + tg;
                        pc2.y = pc2.y + pc2.vy*dt + (300)*tg;
                    }
                    if ((pc2.x >= 370 && pc2.x <= 430) && (pc2.y >= invy-30 && pc2.y <= invy+30)){
                        pc2.vx = 0;
                        pc2.vy = 0;
                    }
                }*/
            }

            pc.desenhar = personagem;

            
            var ctx = canvas.getContext("2d");
            
        function teclaPressionada(e){
            console.log(e.keyCode);
            if (e.keyCode == 39 && pc.x <= canvas.width-30){
                pc.vx = 400;
            }
            if (e.keyCode == 37 && pc.x > 0){
                pc.vx = -400;
            }
            if (e.keyCode == 40 && pc.y <= (canvas.height-35)){
                pc.vy = 800;
            }
            if (e.keyCode == 38 && pc.y > 10 ){
                pc.vy = -800;
            }
            if (e.keyCode == 16){
                pc.vy = pc.vy*2;
                pc.vx = pc.vx*2;
            }
        }
        function teclaSolta(e){
            console.log(e.keyCode);
            if (e.keyCode == 39){
                pc.vx = 0;
            }
            if (e.keyCode == 37){
                pc.vx = 0;
            }
            if (e.keyCode == 40){
                pc.vy = 0;
            }
            if (e.keyCode == 38){
                //pc.vy = 0;
            }
        }
        
        limpaTela();

        function personagem(ctx){
            ctx.fillStyle = "blue";
            ctx.fillRect(this.x,this.y,this.w,this.w);
            ctx.strokeStyle = "white";
            ctx.strokeRect(this.x,this.y,this.w,this.w);
        }

        function inimigo(x,y,t){
            ctx.fillStyle = "black";
            ctx.fillRect(x,y,pc.w,pc.w);
            ctx.strokeStyle = "red";
            ctx.strokeRect(x,y,pc.w,pc.w);
        }

        function limpaTela(){
            ctx.fillStyle = "tan";
            ctx.fillRect(0,0,canvas.width,canvas.height);
        }

        function passo(t){
            dt = (t - anterior)/1000;

            limpaTela();

            ctx.fillStyle = "black"
            ctx.fillText(t,10,10);
            ctx.fillText(dt,10,20);

            pc.desenhar(ctx);
            pc.mover(dt);
            
            pc2.desenhar(ctx);
            pc2.mover(dt);

            pc2.perseguir(pc);
            
            inimigo(400,iny);
            iny = iny + invy*dt;
            
            anterior = t;
            
            if (pc.x >= canvas.width + 60 || pc.x <= 0){
                pc.vx = 0;
            }
            if (pc.y >= (canvas.height-34) || pc.y <= 0){
                pc.v = 0;
            }
            if (iny >= (canvas.height-35) || iny <= 0){
                invy = -invy;
            }
        requestAnimationFrame(passo);
        }
        addEventListener("keydown",teclaPressionada);
        addEventListener("keyup",teclaSolta);
        requestAnimationFrame(passo);

    </script>
</body>
</html>